<!DOCTYPE html>
<html>
<head>
    <title>User Registration</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
</head>
<body>
<div id="app">
    <h2>User Sign-In</h2>
    <form @submit.prevent="signInUser">
        <div>
            <label for="signin-email">Email:</label>
            <input type="email" id="signin-email" v-model="signInData.email" required>
        </div>
        <div>
            <label for="signin-password">Password:</label>
            <input type="password" id="signin-password" v-model="signInData.password" required>
        </div>
        <button type="submit">Sign In</button>
    </form>
    <p v-if="signInMessage">{{ signInMessage }}</p>

    <h2>User Registration</h2>
    <form @submit.prevent="registerUser">
        <div>
            <label for="reg-email">Email:</label>
            <input type="email" id="reg-email" v-model="formData.email" required>
        </div>
        <div>
            <label for="reg-username">Username:</label>
            <input type="text" id="reg-username" v-model="formData.username" required>
        </div>
        <div>
            <label for="reg-password">Password:</label>
            <input type="password" id="reg-password" v-model="formData.password" required>
        </div>
        <div>
            <label for="reg-password2">Confirm Password:</label>
            <input type="password" id="reg-password2" v-model="formData.password2" required>
        </div>
        <button type="submit">Register</button>
    </form>
    <p v-if="message">{{ message }}</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script>
    new Vue({
        el: "#app",
        data: {
            formData: {
                email: "",
                username: "",
                password: "",
                password2: "",
            },
            signInData: {
                email: "",
                password: "",
            },
            message: "",
            signInMessage: "",
        },
        methods: {
            async registerUser() {
                try {
                    const response = await fetch("/users", {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(this.formData),
                    });

                    const data = await response.json();
                    if (response.status === 201) {
                        this.message = data.message;
                    } else {
                        this.message = "Registration failed: " + data.message;
                    }
                } catch (error) {
                    console.error(error);
                    this.message = "Internal Server Error.";
                }
            },
            async signInUser() {
                try {
                    const response = await fetch("/sessions", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(this.signInData),
                    });

                    const data = await response.json();
                    if (response.status === 200) {
                        this.signInMessage = data.message;

                        // Redirect to the dashboard page
                        window.location.href = "/dashboard";
                    } else {
                        this.signInMessage = "Sign-in failed: " + data.message;
                    }
                } catch (error) {
                    console.error(error);
                    this.signInMessage = "Internal Server Error.";
                }
            }
        },
    });
</script>
</body>
</html>